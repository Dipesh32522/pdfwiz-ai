<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PDF Editor Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@3.0.0/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/tesseract.js@v5.2.0/dist/tesseract.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .drop-zone { border: 3px dashed #4f46e5; min-height: 200px; padding: 20px; text-align: center; }
        .tool-btn { transition: all 0.2s; margin: 5px; }
        .tool-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25); }
        .editor-toolbar { background: #f8fafc; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- File Upload -->
    <div class="container mx-auto px-4 py-8">
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Upload PDF to Edit</h2>
            <div id="dropZone" class="drop-zone border-2 border-dashed cursor-pointer">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                </svg>
                <p class="mt-2 text-sm text-gray-500">Drag & drop PDF here or click to browse</p>
                <input type="file" id="fileInput" class="hidden" accept=".pdf">
            </div>
        </div>

        <!-- Editor Tools -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold mb-4">Edit Your PDF</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Text Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Add/Edit Text</h3>
                    <input type="text" id="editText" placeholder="Enter text" class="w-full p-2 mb-2">
                    <button id="addTextBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 tool-btn">Add Text</button>
                </div>

                <!-- Image Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Add Image</h3>
                    <input type="file" id="imageInput" accept="image/*" class="w-full p-2 mb-2">
                    <button id="addImageBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 tool-btn">Insert Image</button>
                </div>

                <!-- Link Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Add Link</h3>
                    <input type="text" id="linkUrl" placeholder="URL" class="w-full p-2 mb-2">
                    <button id="addLinkBtn" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 tool-btn">Attach Link</button>
                </div>

                <!-- Watermark Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Add Watermark</h3>
                    <input type="text" id="watermarkText" placeholder="Watermark text" class="w-full p-2 mb-2">
                    <button id="addWatermarkBtn" class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700 tool-btn">Apply Watermark</button>
                </div>

                <!-- Background Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Set Background</h3>
                    <input type="color" id="backgroundColor" value="#ffffff" class="w-full p-2 mb-2">
                    <button id="setBackgroundBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 tool-btn">Change Background</button>
                </div>

                <!-- Header/Footer Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">Add Header/Footer</h3>
                    <input type="text" id="headerText" placeholder="Header text" class="w-full p-2 mb-2">
                    <input type="text" id="footerText" placeholder="Footer text" class="w-full p-2 mb-2">
                    <button id="addHeaderFooterBtn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 tool-btn">Apply Header/Footer</button>
                </div>

                <!-- OCR Tool -->
                <div class="editor-toolbar">
                    <h3 class="font-semibold mb-2">OCR Scan</h3>
                    <button id="performOcrBtn" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 tool-btn">Make Editable</button>
                </div>
            </div>
        </div>

        <!-- PDF Preview -->
        <div id="previewContainer" class="hidden bg-white rounded-xl shadow-md p-6">
            <h2 class="text-2xl font-bold mb-4">PDF Preview</h2>
            <div class="flex flex-wrap gap-4">
                <div id="pdfPreview" class="border rounded overflow-hidden max-w-md"></div>
            </div>
            <button id="downloadBtn" class="mt-4 bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 disabled:opacity-50" disabled>
                Download Edited PDF
            </button>
        </div>
    </div>

    <!-- Core JS -->
    <script>
        // Global variables
        let pdfDoc = null;
        let currentPage = 1;
        const previewDiv = document.getElementById('previewContainer');
        const pdfPreview = document.getElementById('pdfPreview');

        // Event Listeners
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        document.getElementById('dropZone').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('dropZone').addEventListener('dragover', (e) => {
            e.preventDefault();
            document.getElementById('dropZone').classList.add('border-blue-500', 'bg-blue-50');
        });
        document.getElementById('dropZone').addEventListener('dragleave', () => {
            document.getElementById('dropZone').classList.remove('border-blue-500', 'bg-blue-50');
        });
        document.getElementById('dropZone').addEventListener('drop', (e) => {
            e.preventDefault();
            document.getElementById('dropZone').classList.remove('border-blue-500', 'bg-blue-50');
            if (e.dataTransfer.files.length) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                handleFileUpload();
            }
        });

        // Text Editing
        document.getElementById('addTextBtn').addEventListener('click', async () => {
            if (!pdfDoc || !document.getElementById('editText').value.trim()) return;
            await addTextToPDF(document.getElementById('editText').value);
            updatePreview();
        });

        // Image Insertion
        document.getElementById('imageInput').addEventListener('change', async (e) => {
            if (!pdfDoc || !e.target.files[0]) return;
            await addImageToPDF(e.target.files[0]);
            updatePreview();
        });

        // Link Addition
        document.getElementById('addLinkBtn').addEventListener('click', async () => {
            if (!pdfDoc || !document.getElementById('linkUrl').value.trim()) return;
            await addLinkToPDF(document.getElementById('linkUrl').value);
            updatePreview();
        });

        // Watermark
        document.getElementById('addWatermarkBtn').addEventListener('click', async () => {
            if (!pdfDoc || !document.getElementById('watermarkText').value.trim()) return;
            await addWatermarkToPDF(document.getElementById('watermarkText').value);
            updatePreview();
        });

        // Background Color
        document.getElementById('setBackgroundBtn').addEventListener('click', async () => {
            if (!pdfDoc) return;
            await setPdfBackgroundColor(document.getElementById('backgroundColor').value);
            updatePreview();
        });

        // Header/Footer
        document.getElementById('addHeaderFooterBtn').addEventListener('click', async () => {
            if (!pdfDoc) return;
            await addHeaderFooter(
                document.getElementById('headerText').value,
                document.getElementById('footerText').value
            );
            updatePreview();
        });

        // OCR
        document.getElementById('performOcrBtn').addEventListener('click', async () => {
            if (!pdfDoc) return;
            await performOCR();
            updatePreview();
        });

        // Download
        document.getElementById('downloadBtn').addEventListener('click', () => downloadPDF());

        // Core Functions
        async function handleFileUpload() {
            const file = document.getElementById('fileInput').files[0];
            if (!file || file.type !== 'application/pdf') return;

            // Show loading state
            document.getElementById('previewContainer').classList.remove('hidden');
            document.getElementById('downloadBtn').disabled = true;

            // Load PDF
            const reader = new FileReader();
            reader.onload = async () => {
                const typedArray = new Uint8Array(reader.result);
                pdfDoc = await pdfLib.PDFDocument.load(typedArray);
                await updatePreview();
                document.getElementById('downloadBtn').disabled = false;
            };
            reader.readAsArrayBuffer(file);
        }

        async function updatePreview() {
            // Clear existing preview
            while (pdfPreview.firstChild) {
                pdfPreview.removeChild(pdfPreview.firstChild);
            }

            // Render first page for preview
            const tempDoc = await pdfLib.PDFDocument.create();
            const page = await tempDoc.copyPage(pdfDoc.getPage(1));
            tempDoc.addPage(page);

            // Convert to blob and display
            const pdfBytes = await tempDoc.save();
            const blob = new Blob([pdfBytes], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.style.width = '100%';
            iframe.style.height = '500px';
            pdfPreview.appendChild(iframe);
        }

        async function addTextToPDF(text) {
            const page = pdfDoc.getPage(1);
            const { width, height } = page.getSize();
            const fontSize = 12;
            const font = await pdfDoc.embedFont(pdfLib.StandardFonts.Helvetica);
            await page.drawText(text, {
                x: width / 2,
                y: height / 2,
                size: fontSize,
                font,
                color: pdfLib.rgb(0, 0, 0),
                rotate: pdfLib.degrees(0),
                width: width - 50,
                align: 'center'
            });
        }

        async function addImageToPDF(imageFile) {
            const page = pdfDoc.getPage(1);
            const img = await pdfDoc.embedPng(await imageFile.arrayBuffer());
            await page.drawImage(img, {
                x: 50,
                y: 50,
                width: 200,
                height: 200
            });
        }

        async function addLinkToPDF(url) {
            const page = pdfDoc.getPage(1);
            const annotation = pdfLib.Annotation.link({
                rect: [50, 50, 150, 75],
                url
            });
            await page.addAnnotation(annotation);
        }

        async function addWatermarkToPDF(text) {
            const page = pdfDoc.getPage(1);
            const font = await pdfDoc.embedFont(pdfLib.StandardFonts.HelveticaBold);
            await page.drawText(text, {
                x: page.getWidth() / 2,
                y: page.getHeight() / 2,
                size: 50,
                font,
                color: pdfLib.rgb(0.5, 0.5, 0.5, 0.3), // Semi-transparent gray
                rotate: pdfLib.degrees(45),
                width: page.getWidth(),
                align: 'center'
            });
        }

        async function setPdfBackgroundColor(color) {
            const page = pdfDoc.getPage(1);
            await page.setBackgroundColor(color);
        }

        async function addHeaderFooter(header, footer) {
            for (let i = 1; i <= pdfDoc.getPages().length; i++) {
                const page = pdfDoc.getPage(i);
                const font = await pdfDoc.embedFont(pdfLib.StandardFonts.Helvetica);
                
                // Header
                await page.drawText(header, {
                    x: 50,
                    y: page.getHeight() - 30,
                    size: 10,
                    font,
                    color: pdfLib.rgb(0, 0, 0)
                });

                // Footer
                await page.drawText(footer, {
                    x: 50,
                    y: 30,
                    size: 10,
                    font,
                    color: pdfLib.rgb(0, 0, 0)
                });
            }
        }

        async function performOCR() {
            for (let i = 1; i <= pdfDoc.getPages().length; i++) {
                const page = pdfDoc.getPage(i);
                const image = await page.render({ 
                    canvasContext: null, 
                    intent: "print", 
                    scale: 1.5 
                });
                const ocrResult = await Tesseract.recognize(image, 'eng', { logger: m => console.log(m) });
                await page.insertText(ocrResult.text, {
                    x: 50,
                    y: page.getHeight() - 50,
                    size: 12,
                    font: await pdfDoc.embedFont(pdfLib.StandardFonts.Helvetica)
                });
            }
        }

        function downloadPDF() {
            pdfDoc.save().then(bytes => {
                const blob = new Blob([bytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'edited-document.pdf';
                a.click();
            });
        }
    </script>
</body>
</html>
